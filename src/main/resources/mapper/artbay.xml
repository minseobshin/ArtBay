<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.artbay.mybatis.ArtBayMapper">
	<!-- 회원가입 -->
	<insert id="insertMember" parameterType="kr.artbay.common.ArtBayVo">
		insert into artbay_member(mid, injung, irum, birth, phone, email, gender, age, pwd, zip, address, address2, mdate, m_status)
		values(#{mid}, #{injung}, #{irum}, #{birth}, #{phone}, #{memberJoinEmail}, #{gender}, #{age}, #{pwd}, #{zip}, #{address}, #{address2}, now(), #{m_status})
	</insert>
	<!-- 아이디 중복체크 -->
	<select id="checkId" parameterType="String" resultType="String">
		select mid from artbay_member where mid like #{_parameter}
	</select>


	<select id="totSize" parameterType="String" resultType="Integer">
		select count(lot) totSize from artwork
		where mid like '%${_parameter}%' or artwork_name like '%${_parameter}%'
	</select>
	
	<select id="search" parameterType="kr.artbay.common.Page" resultType="kr.artbay.common.ArtBayVo">
		select lot, mid, artwork_name, artwork_ctgr, artist, material, artwork_size, start_price, current_price,
				regist_date, due_date, hit, direct_price, bid_cnt, crnt_status from artwork
		where mid like '%${findStr}%' or artist like '%${findStr}%' or artwork_ctgr like '%${findStr}%'
		limit ${startNo-1}, ${listSize};
	</select>
	
	<select id='noticeSave' parameterType="kr.artbay.common.ArtBayVo">
		insert into(title, doc, not_date) 
		values (#{title}, #{doc}, ${not_date})
	</select>
	
	<insert id="insertArtWork" parameterType="kr.artbay.common.ArtBayVo">
		insert into artwork(mid, artwork_name, artwork_ctgr, artist, material, 
			artwork_size, start_price, current_price, regist_date, due_date, direct_price, hit, bid_cnt, crnt_status)
		values(#{mid}, #{artwork_name}, #{artwork_ctgr}, #{artist}, #{material}, #{artwork_size}, #{start_price}, 0,
				now(), (SELECT DATE_ADD(NOW(), INTERVAL 7 DAY)), #{direct_price}, 0, 0, #{crnt_status} )
	</insert>
	<insert id="imgInsert" parameterType="kr.artbay.common.ArtBayAtt">
		insert into artimg(lot, imgFile, thumbnail)
		values (#{lot}, #{imgFile}, #{thumbnail})
	</insert>
	<select id="view" parameterType="Integer" resultType="kr.artbay.common.ArtBayVo">
		select * from artwork where lot = ${_parameter};
	</select>
	
	<select id="attList" parameterType="Integer" resultType="kr.artbay.common.ArtBayAtt">
		select * from artimg where lot = #{_parameter};	
	</select>

	<select id='faqList' parameterType="String" resultType="kr.artbay.common.ArtBayVo">
		select * from faq where ctgr = #{_parameter};
	</select>



	<!-- QNA 조회 건수 -->
	<select id="qnaTotSize" parameterType="String" resultType="Integer">
		SELECT COUNT(QNA_NUM) FROM QNA
		WHERE QNA_TITLE LIKE '%${_parameter}%'
	</select>
	
	<!-- QNA 조회 -->
	<select id="qnaSearch" parameterType="kr.artbay.common.Page" resultType="kr.artbay.common.ArtBayVo">
		SELECT 
			QNA_NUM, MID, QNA_DOC, GRP, SEQ, DEEP,
			DATE_FORMAT(QNA_DATE, "%y-%m-%d") QNA_DATE,						 
			CONCAT(LPAD(" ", DEEP*6, "&#160;"), QNA_TITLE) QNA_TITLE
		FROM 
			QNA q
		WHERE 
			QNA_TITLE LIKE '%${findStr}%'
		ORDER BY 
			GRP DESC, SEQ ASC 
		LIMIT 
			${startNo-1}, ${listSize}
	</select>



</mapper>